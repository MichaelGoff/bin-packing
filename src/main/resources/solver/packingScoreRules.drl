package solver;
    dialect "java"

import org.optaplanner.core.api.score.buildin.hardsoftdouble.HardSoftDoubleScoreHolder;

import domain.Packing;
import domain.Part;
import domain.Platform;

global HardSoftDoubleScoreHolder scoreHolder;

//*****************
// Hard Constraints
//*****************

rule "partOverlap"        //TODO: why does this produce a positive hard score?
    when
        $p1 : Part($id : id)
        $p2 : Part(intersects($p1) == true, id > $id)

    then
        scoreHolder.addHardConstraintMatch(kcontext, -$p2.intersectArea($p1));
end

rule "outOfPlatformBoundsWidth"
    when
        $part : Part(widthOverlapsPlatform() == true, $id : id)
    then
        scoreHolder.addHardConstraintMatch(kcontext, -$part.widthOverlap());
end

rule "outOfPlatformBoundsHeight"
    when
        $part : Part(heightOverlapsPlatform() == true, $id : id)

    then
        scoreHolder.addHardConstraintMatch(kcontext, -$part.heightOverlap());
end

//*****************
// Soft Constraints
//*****************

rule "leftoverSpace"
    when
        $platform : Platform(isEmpty() == false, $id : id)
    then
        scoreHolder.addSoftConstraintMatch(kcontext, -$platform.getLeftoverArea());
end